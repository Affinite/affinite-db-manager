(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var n in t)e.o(t,n)&&!e.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:t[n]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.React,t=window.wp.element,n=window.wp.components,l=window.wp.i18n,i=window.wp.apiFetch;var r=e.n(i);const m="/affinite-db-manager/v1",c=async()=>r()({path:`${m}/settings`}),s=({active:e,onUpdate:i,showNotification:c})=>{const[s,o]=(0,t.useState)(!1),[d,f]=(0,t.useState)(e);(0,t.useEffect)(()=>{f(e)},[e]);const u=(0,t.useCallback)(async e=>{if(d===e||s)return;const a=d;f(e),o(!0);try{const a=e?(async()=>r()({path:`${m}/settings/activate`,method:"POST"}))():(async()=>r()({path:`${m}/settings/deactivate`,method:"POST"}))();await a,c(e?(0,l.__)("DB Manager activated.","affinite-db-manager"):(0,l.__)("DB Manager deactivated.","affinite-db-manager"),"success"),i&&i()}catch(e){f(a),c(e.message||(0,l.__)("Failed to update status.","affinite-db-manager"),"error")}finally{o(!1)}},[d,s,i,c]);return(0,a.createElement)("div",{className:"affinite-db-manager__status"},(0,a.createElement)(n.ToggleControl,{label:(0,l.__)("DB Manager Status","affinite-db-manager"),checked:d,onChange:u,disabled:s,help:d?(0,l.__)("DB Manager is active and accessible.","affinite-db-manager"):(0,l.__)("DB Manager is inactive and not accessible.","affinite-db-manager")}),s&&(0,a.createElement)("span",{className:"affinite-db-manager__updating-indicator"},(0,l.__)("Updating...","affinite-db-manager")))},o=({emails:e,onUpdate:i,showNotification:c})=>{const[s,o]=(0,t.useState)(""),[d,f]=(0,t.useState)(e),[u,_]=(0,t.useState)(new Set);(0,t.useEffect)(()=>{f(e)},[e]);const b=(0,t.useCallback)(async()=>{const e=s.trim();if(!e)return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return void c((0,l.__)("Please enter a valid email address.","affinite-db-manager"),"error");if(d.includes(e))return void c((0,l.__)("Email already in whitelist.","affinite-db-manager"),"warning");const a=[...d];f([...d,e]),o(""),_(a=>new Set(a).add(e));try{await(async e=>r()({path:`${m}/settings/emails`,method:"POST",data:{email:e}}))(e),c((0,l.__)("Email added successfully.","affinite-db-manager"),"success"),i&&i()}catch(e){f(a),c(e.message||(0,l.__)("Failed to add email.","affinite-db-manager"),"error")}finally{_(a=>{const t=new Set(a);return t.delete(e),t})}},[s,d,i,c]),g=(0,t.useCallback)(async e=>{if(u.has(e))return;const a=[...d];f(d.filter(a=>a!==e)),_(a=>new Set(a).add(e));try{await(async e=>r()({path:`${m}/settings/emails?email=${encodeURIComponent(e)}`,method:"DELETE"}))(e),c((0,l.__)("Email removed successfully.","affinite-db-manager"),"success"),i&&i()}catch(e){f(a),c(e.message||(0,l.__)("Failed to remove email.","affinite-db-manager"),"error")}finally{_(a=>{const t=new Set(a);return t.delete(e),t})}},[d,u,i,c]),E=(0,t.useCallback)(e=>{"Enter"===e.key&&b()},[b]);return(0,a.createElement)("div",{className:"affinite-db-manager__email-whitelist"},(0,a.createElement)("p",{className:"description"},(0,l.__)("Leave empty to allow all administrators. Add emails to restrict access to specific users.","affinite-db-manager")),d.length>0?(0,a.createElement)("ul",{className:"affinite-db-manager__email-list"},d.map(e=>{const t=u.has(e);return(0,a.createElement)("li",{key:e,className:"affinite-db-manager__email-item"},(0,a.createElement)("span",null,e),(0,a.createElement)(n.Button,{variant:"link",onClick:()=>g(e),disabled:t,isDestructive:!0,"aria-label":(0,l.__)("Remove email","affinite-db-manager")},t?"...":"Ã—"))})):(0,a.createElement)("p",null,(0,a.createElement)("em",null,(0,l.__)("No email restrictions. All administrators have access.","affinite-db-manager"))),(0,a.createElement)("div",{className:"affinite-db-manager__add-email"},(0,a.createElement)(n.TextControl,{type:"email",value:s,onChange:o,onKeyPress:E,placeholder:(0,l.__)("user@example.com","affinite-db-manager"),disabled:u.size>0}),(0,a.createElement)(n.Button,{variant:"secondary",onClick:b,disabled:!s.trim()||u.size>0},(0,l.__)("Add","affinite-db-manager"))))},d="/affinite-db-manager/v1",f=async()=>r()({path:`${d}/tables`}),u=({value:e,onChange:t,placeholder:i=(0,l.__)("Search...","affinite-db-manager"),className:r=""})=>(0,a.createElement)("div",{className:`affinite-db-manager__search ${r}`},(0,a.createElement)(n.TextControl,{value:e,onChange:t,placeholder:i,type:"search"})),_=({title:e,children:l,onClose:i,footer:r,className:m="",width:c})=>((0,t.useEffect)(()=>{const e=e=>{"Escape"===e.key&&i()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[i]),(0,t.useEffect)(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),(0,a.createElement)("div",{className:"affinite-db-manager__modal-overlay",onClick:e=>{e.target===e.currentTarget&&i()},role:"dialog","aria-modal":"true","aria-labelledby":"modal-title"},(0,a.createElement)("div",{className:`affinite-db-manager__modal ${m}`.trim(),style:c?{width:"number"==typeof c?`${c}px`:c,maxWidth:"number"==typeof c?`${c}px`:c}:{}},(0,a.createElement)("div",{className:"affinite-db-manager__modal-header"},(0,a.createElement)("h3",{id:"modal-title"},e),(0,a.createElement)(n.Button,{variant:"link",onClick:i,"aria-label":"Close modal"},"Ã—")),(0,a.createElement)("div",{className:"affinite-db-manager__modal-body"},l),r&&(0,a.createElement)("div",{className:"affinite-db-manager__modal-footer"},r)))),b=({title:e,message:i,confirmText:r="",confirmLabel:m=(0,l.__)("Confirm","affinite-db-manager"),cancelLabel:c=(0,l.__)("Cancel","affinite-db-manager"),isDangerous:s=!1,onConfirm:o,onCancel:d})=>{const[f,u]=(0,t.useState)(""),[b,g]=(0,t.useState)(!1),E=r.length>0,h=!E||f===r,v=(0,a.createElement)(a.Fragment,null,(0,a.createElement)(n.Button,{variant:"secondary",onClick:d,disabled:b},c),(0,a.createElement)(n.Button,{variant:"primary",onClick:async()=>{if(h){g(!0);try{await o()}finally{g(!1)}}},disabled:!h||b,isBusy:b,isDestructive:s},m));return(0,a.createElement)(_,{title:e,onClose:d,footer:v},(0,a.createElement)("p",null,i),E&&(0,a.createElement)("div",{className:"affinite-db-manager__confirm-input"},(0,a.createElement)("label",null,(0,l.__)("To confirm, type","affinite-db-manager")," ",(0,a.createElement)("strong",null,r),":"),(0,a.createElement)(n.TextControl,{value:f,onChange:u,placeholder:r})))},g=(0,t.memo)(({locked:e=!1,className:t="",size:n=20})=>{const l=`affinite-db-manager__lock-icon-svg ${t}`.trim();return e?(0,a.createElement)("svg",{className:l,width:n,height:n,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},(0,a.createElement)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z",fill:"currentColor"})):(0,a.createElement)("svg",{className:l,width:n,height:n,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},(0,a.createElement)("path",{d:"M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2z",fill:"currentColor"}))});g.displayName="LockIcon";const E=g,h=({active:e,lockedTables:i,onUpdate:m,showNotification:c})=>{const[s,o]=(0,t.useState)([]),[_,g]=(0,t.useState)(!1),[h,v]=(0,t.useState)(new Set(i)),[y,p]=(0,t.useState)(new Set),[C,N]=(0,t.useState)(""),[w,S]=(0,t.useState)(null);(0,t.useEffect)(()=>{v(new Set(i))},[i]),(0,t.useEffect)(()=>{let a=!1;return e?((async()=>{try{g(!0);const e=await f();a||o(e)}catch(e){a||c(e.message||(0,l.__)("Failed to load tables.","affinite-db-manager"),"error")}finally{a||g(!1)}})(),()=>{a=!0}):(o([]),void g(!1))},[e,c]);const k=(0,t.useMemo)(()=>{if(!C)return s;const e=C.toLowerCase();return s.filter(a=>a.name.toLowerCase().includes(e))},[s,C]),T=(0,t.useCallback)(async e=>{if(!y.has(e)){v(a=>new Set(a).add(e)),p(a=>new Set(a).add(e));try{await(async e=>r()({path:`${d}/tables/${e}/lock`,method:"POST"}))(e),c((0,l.__)("Table locked successfully.","affinite-db-manager"),"success"),m&&m()}catch(a){v(a=>{const t=new Set(a);return t.delete(e),t}),c(a.message||(0,l.__)("Failed to lock table.","affinite-db-manager"),"error")}finally{p(a=>{const t=new Set(a);return t.delete(e),t})}}},[y,m,c]),B=(0,t.useCallback)(e=>{e.is_core?S(e):L(e.name)},[]),L=(0,t.useCallback)(async e=>{if(!y.has(e)){v(a=>{const t=new Set(a);return t.delete(e),t}),p(a=>new Set(a).add(e));try{await(async e=>r()({path:`${d}/tables/${e}/unlock`,method:"POST"}))(e),c((0,l.__)("Table unlocked successfully.","affinite-db-manager"),"success"),S(null),m&&m()}catch(a){v(a=>new Set(a).add(e)),c(a.message||(0,l.__)("Failed to unlock table.","affinite-db-manager"),"error")}finally{p(a=>{const t=new Set(a);return t.delete(e),t})}}},[y,m,c]),x=(0,t.useCallback)(e=>h.has(e),[h]);return e?_?(0,a.createElement)("div",{className:"affinite-db-manager__loading"},(0,a.createElement)(n.Spinner,null),(0,a.createElement)("span",null,(0,l.__)("Loading tables...","affinite-db-manager"))):(0,a.createElement)("div",{className:"affinite-db-manager__table-locks"},(0,a.createElement)("div",{className:"affinite-db-manager__table-search"},(0,a.createElement)(u,{value:C,onChange:N,placeholder:(0,l.__)("Search tables...","affinite-db-manager")})),(0,a.createElement)("div",{className:"affinite-db-manager__table-list"},k.map(e=>{const t=x(e.name),i=y.has(e.name);return(0,a.createElement)("div",{key:e.name,className:`affinite-db-manager__table-item ${t?"affinite-db-manager__table-item--locked":""} ${i?"affinite-db-manager__table-item--updating":""}`},(0,a.createElement)("div",{className:"affinite-db-manager__table-name"},(0,a.createElement)(E,{locked:t}),(0,a.createElement)("span",null,e.name),e.is_core&&(0,a.createElement)("span",{className:"affinite-db-manager__core-badge",title:(0,l.__)("WordPress Core Table","affinite-db-manager")},"core")),(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>t?B(e):T(e.name),disabled:i,isSmall:!0},i?"...":t?(0,l.__)("Unlock","affinite-db-manager"):(0,l.__)("Lock","affinite-db-manager")))}),0===k.length&&!_&&(0,a.createElement)("div",{className:"affinite-db-manager__no-tables"},(0,l.__)("No tables found.","affinite-db-manager"))),w&&(0,a.createElement)(b,{title:(0,l.__)("Warning","affinite-db-manager"),message:(0,l.__)(`Table ${w.name} is a WordPress core table. Modifications may damage your website.`,"affinite-db-manager"),confirmText:w.name,confirmLabel:(0,l.__)("Unlock","affinite-db-manager"),isDangerous:!0,onConfirm:()=>L(w.name),onCancel:()=>S(null)})):(0,a.createElement)("div",{className:"affinite-db-manager__table-locks-inactive"},(0,a.createElement)("p",null,(0,l.__)("Activate DB Manager to view and manage table locks.","affinite-db-manager")))},v=(0,t.memo)(({settings:e,onUpdate:t,showNotification:n})=>{var i,r,m,c;return e?(0,a.createElement)("div",{className:"affinite-db-manager__settings"},(0,a.createElement)("div",{className:"affinite-db-manager__card"},(0,a.createElement)("div",{className:"affinite-db-manager__card-header"},(0,a.createElement)("h2",null,(0,l.__)("Status","affinite-db-manager"))),(0,a.createElement)("div",{className:"affinite-db-manager__card-body"},(0,a.createElement)(s,{active:null!==(i=e.active)&&void 0!==i&&i,onUpdate:t,showNotification:n}))),(0,a.createElement)("div",{className:"affinite-db-manager__card"},(0,a.createElement)("div",{className:"affinite-db-manager__card-header"},(0,a.createElement)("h2",null,(0,l.__)("Allowed Users","affinite-db-manager"))),(0,a.createElement)("div",{className:"affinite-db-manager__card-body"},(0,a.createElement)(o,{emails:null!==(r=e.allowed_emails)&&void 0!==r?r:[],onUpdate:t,showNotification:n}))),(0,a.createElement)("div",{className:"affinite-db-manager__card"},(0,a.createElement)("div",{className:"affinite-db-manager__card-header"},(0,a.createElement)("h2",null,(0,l.__)("Table Locks","affinite-db-manager"))),(0,a.createElement)("div",{className:"affinite-db-manager__card-body"},(0,a.createElement)(h,{active:null!==(m=e.active)&&void 0!==m&&m,lockedTables:null!==(c=e.locked_tables)&&void 0!==c?c:[],onUpdate:t,showNotification:n})))):null});v.displayName="SettingsPage";const y=v,p=[{label:"TINYINT",value:"TINYINT"},{label:"SMALLINT",value:"SMALLINT"},{label:"MEDIUMINT",value:"MEDIUMINT"},{label:"INT",value:"INT"},{label:"BIGINT",value:"BIGINT"},{label:"DECIMAL",value:"DECIMAL"},{label:"FLOAT",value:"FLOAT"},{label:"DOUBLE",value:"DOUBLE"},{label:"CHAR",value:"CHAR"},{label:"VARCHAR",value:"VARCHAR"},{label:"TINYTEXT",value:"TINYTEXT"},{label:"TEXT",value:"TEXT"},{label:"MEDIUMTEXT",value:"MEDIUMTEXT"},{label:"LONGTEXT",value:"LONGTEXT"},{label:"TINYBLOB",value:"TINYBLOB"},{label:"BLOB",value:"BLOB"},{label:"MEDIUMBLOB",value:"MEDIUMBLOB"},{label:"LONGBLOB",value:"LONGBLOB"},{label:"DATE",value:"DATE"},{label:"TIME",value:"TIME"},{label:"DATETIME",value:"DATETIME"},{label:"TIMESTAMP",value:"TIMESTAMP"},{label:"YEAR",value:"YEAR"},{label:"JSON",value:"JSON"}],C=({onClose:e,onSuccess:i,showNotification:m})=>{const[c,s]=(0,t.useState)(""),[o,f]=(0,t.useState)([{name:"id",type:"BIGINT",length:20,nullable:!1,auto_increment:!0,primary:!0}]),[u,b]=(0,t.useState)(!1),g=(e,a,t)=>{const n=[...o];n[e]={...n[e],[a]:t},f(n)},E=(0,a.createElement)(a.Fragment,null,(0,a.createElement)(n.Button,{variant:"secondary",onClick:e,disabled:u},(0,l.__)("Cancel","affinite-db-manager")),(0,a.createElement)(n.Button,{variant:"primary",onClick:async()=>{if(c){for(const e of o)if(!e.name)return void m((0,l.__)("All columns must have a name.","affinite-db-manager"),"error");b(!0);try{await(async(e,a)=>r()({path:`${d}/tables`,method:"POST",data:{name:e,columns:a}}))(c,o),m((0,l.__)("Table created successfully.","affinite-db-manager"),"success"),i()}catch(e){m(e.message||(0,l.__)("Failed to create table.","affinite-db-manager"),"error")}finally{b(!1)}}else m((0,l.__)("Table name is required.","affinite-db-manager"),"error")},isBusy:u,disabled:u},(0,l.__)("Create","affinite-db-manager")));return(0,a.createElement)(_,{title:(0,l.__)("New Table","affinite-db-manager"),onClose:e,footer:E,width:1e3},(0,a.createElement)("div",{className:"affinite-db-manager__form-group"},(0,a.createElement)("label",null,(0,l.__)("Table Name","affinite-db-manager")),(0,a.createElement)("div",{style:{display:"flex",alignItems:"center",gap:"5px"}},(0,a.createElement)("span",null,"wp_"),(0,a.createElement)(n.TextControl,{value:c,onChange:s,placeholder:(0,l.__)("my_table","affinite-db-manager")}))),(0,a.createElement)("div",{className:"affinite-db-manager__form-group"},(0,a.createElement)("label",null,(0,l.__)("Columns","affinite-db-manager")),o.map((e,t)=>(0,a.createElement)("div",{key:t,style:{marginBottom:"15px",padding:"10px",background:"#f6f7f7",borderRadius:"4px"}},(0,a.createElement)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 80px",gap:"10px",marginBottom:"10px"}},(0,a.createElement)(n.TextControl,{label:(0,l.__)("Name","affinite-db-manager"),value:e.name,onChange:e=>g(t,"name",e)}),(0,a.createElement)(n.SelectControl,{label:(0,l.__)("Type","affinite-db-manager"),value:e.type,options:p,onChange:e=>g(t,"type",e)}),(0,a.createElement)(n.TextControl,{label:(0,l.__)("Length","affinite-db-manager"),type:"number",value:e.length||"",onChange:e=>g(t,"length",parseInt(e)||null)})),(0,a.createElement)("div",{style:{display:"flex",gap:"20px",alignItems:"center"}},(0,a.createElement)(n.CheckboxControl,{label:(0,l.__)("Nullable","affinite-db-manager"),checked:e.nullable,onChange:e=>g(t,"nullable",e)}),(0,a.createElement)(n.CheckboxControl,{label:(0,l.__)("Auto Increment","affinite-db-manager"),checked:e.auto_increment,onChange:e=>g(t,"auto_increment",e)}),(0,a.createElement)(n.CheckboxControl,{label:(0,l.__)("Primary Key","affinite-db-manager"),checked:e.primary,onChange:e=>g(t,"primary",e)}),(0,a.createElement)(n.Button,{variant:"link",isDestructive:!0,onClick:()=>(e=>{o.length<=1?m((0,l.__)("At least one column is required.","affinite-db-manager"),"warning"):f(o.filter((a,t)=>t!==e))})(t)},(0,l.__)("Remove","affinite-db-manager"))))),(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>{f([...o,{name:"",type:"VARCHAR",length:255,nullable:!0,auto_increment:!1,primary:!1}])}},(0,l.__)("+ Add Column","affinite-db-manager"))))},N=(0,t.memo)(({className:e="",size:t=20})=>{const n=`affinite-db-manager__icon-svg ${e}`.trim();return(0,a.createElement)("svg",{className:n,width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},(0,a.createElement)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z",fill:"currentColor"}))});N.displayName="ViewIcon";const w=N,S=(0,t.memo)(({className:e="",size:t=20})=>{const n=`affinite-db-manager__icon-svg ${e}`.trim();return(0,a.createElement)("svg",{className:n,width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},(0,a.createElement)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"currentColor"}))});S.displayName="EditIcon";const k=S,T=(0,t.memo)(({className:e="",size:t=20})=>{const n=`affinite-db-manager__icon-svg ${e}`.trim();return(0,a.createElement)("svg",{className:n,width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},(0,a.createElement)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z",fill:"currentColor"}))});T.displayName="DeleteIcon";const B=T,L=(0,t.memo)(({onSelectTable:e,showNotification:i})=>{const{tables:m,loading:c,error:s,refetch:o}=(()=>{const[e,a]=(0,t.useState)([]),[n,l]=(0,t.useState)(!0),[i,r]=(0,t.useState)(null),m=(0,t.useCallback)(async()=>{try{l(!0),r(null);const e=await f();a(e)}catch(e){r(e.message||"Failed to load tables")}finally{l(!1)}},[]),c=(0,t.useCallback)(()=>{m()},[m]);return(0,t.useEffect)(()=>{m()},[m]),{tables:e,loading:n,error:i,refetch:c}})(),[_,g]=(0,t.useState)(""),[h,v]=(0,t.useState)(!1),[y,p]=(0,t.useState)(!1),[N,S]=(0,t.useState)(null),[T,L]=(0,t.useState)(!1),x=(0,t.useMemo)(()=>{let e=m;if(h&&(e=e.filter(e=>!e.is_locked)),_){const a=_.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(a))}return e},[m,_,h]),I=a=>{e(a)};return c?(0,a.createElement)("div",{className:"affinite-db-manager__loading"},(0,a.createElement)(n.Spinner,null),(0,a.createElement)("span",null,(0,l.__)("Loading tables...","affinite-db-manager"))):s?(0,a.createElement)("div",{className:"affinite-db-manager__error"},(0,a.createElement)("p",null,s),(0,a.createElement)(n.Button,{variant:"primary",onClick:o},(0,l.__)("Retry","affinite-db-manager"))):(0,a.createElement)("div",{className:"affinite-db-manager__table-list-page"},(0,a.createElement)("div",{className:"affinite-db-manager__toolbar"},(0,a.createElement)(n.Button,{variant:"primary",onClick:()=>L(!0)},(0,l.__)("+ New Table","affinite-db-manager")),(0,a.createElement)("div",{className:"affinite-db-manager__toolbar-filters"},(0,a.createElement)(u,{value:_,onChange:g,placeholder:(0,l.__)("Search tables...","affinite-db-manager")}),(0,a.createElement)(n.CheckboxControl,{label:(0,l.__)("Hide locked tables","affinite-db-manager"),checked:h,onChange:v}))),(0,a.createElement)("div",{className:"affinite-db-manager__card"},(0,a.createElement)("table",{className:"affinite-db-manager__data-table"},(0,a.createElement)("thead",null,(0,a.createElement)("tr",null,(0,a.createElement)("th",null,(0,l.__)("Table","affinite-db-manager")),(0,a.createElement)("th",null,(0,l.__)("Columns","affinite-db-manager")),(0,a.createElement)("th",null,(0,l.__)("Rows","affinite-db-manager")),(0,a.createElement)("th",null,(0,l.__)("Actions","affinite-db-manager")))),(0,a.createElement)("tbody",null,x.map(e=>(0,a.createElement)("tr",{key:e.name},(0,a.createElement)("td",null,(0,a.createElement)("span",{className:"affinite-db-manager__table-name"},(0,a.createElement)(E,{locked:e.is_locked}),e.name)),(0,a.createElement)("td",null,e.columns),(0,a.createElement)("td",null,e.rows.toLocaleString()),(0,a.createElement)("td",null,(0,a.createElement)("div",{className:"affinite-db-manager__actions"},(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>I(e.name),isSmall:!0,title:(0,l.__)("View","affinite-db-manager")},(0,a.createElement)(w,null)),!e.is_locked&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>I(e.name),isSmall:!0,title:(0,l.__)("Edit","affinite-db-manager")},(0,a.createElement)(k,null)),(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>(e=>{S(e)})(e),isSmall:!0,isDestructive:!0,title:(0,l.__)("Delete","affinite-db-manager")},(0,a.createElement)(B,null))))))),0===x.length&&(0,a.createElement)("tr",null,(0,a.createElement)("td",{colSpan:"4",style:{textAlign:"center"}},(0,l.__)("No tables found.","affinite-db-manager")))))),N&&(0,a.createElement)(b,{title:(0,l.__)("Delete Table","affinite-db-manager"),message:(0,l.__)(`Are you sure you want to delete table "${N.name}"? This action cannot be undone.`,"affinite-db-manager"),confirmText:N.name,confirmLabel:(0,l.__)("Delete","affinite-db-manager"),isDangerous:!0,onConfirm:async()=>{if(N){p(!0);try{await(async e=>r()({path:`${d}/tables/${e}`,method:"DELETE"}))(N.name),i((0,l.__)("Table deleted successfully.","affinite-db-manager"),"success"),S(null),o()}catch(e){i(e.message||(0,l.__)("Failed to delete table.","affinite-db-manager"),"error")}finally{p(!1)}}},onCancel:()=>S(null)}),T&&(0,a.createElement)(C,{onClose:()=>L(!1),onSuccess:()=>{L(!1),o()},showNotification:i}))}),x="/affinite-db-manager/v1",I=async e=>r()({path:`${x}/tables/${e}/columns`}),A="/affinite-db-manager/v1",D=async e=>r()({path:`${A}/tables/${e}/indexes`}),$="/affinite-db-manager/v1",M=async e=>r()({path:`${$}/tables/${e}/relations`}),R=async(e,a=100,t=0)=>r()({path:`/affinite-db-manager/v1/tables/${e}/data?limit=${a}&offset=${t}`}),O=({column:e,onChange:t})=>{const i=(a,n)=>{t({...e,[a]:n})};return(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"affinite-db-manager__form-group"},(0,a.createElement)(n.TextControl,{label:(0,l.__)("Name","affinite-db-manager"),value:e.name,onChange:e=>i("name",e)})),(0,a.createElement)("div",{className:"affinite-db-manager__form-group"},(0,a.createElement)(n.SelectControl,{label:(0,l.__)("Type","affinite-db-manager"),value:e.type,options:p,onChange:e=>i("type",e)})),(0,a.createElement)("div",{className:"affinite-db-manager__form-group"},(0,a.createElement)(n.TextControl,{label:(0,l.__)("Length","affinite-db-manager"),type:"number",value:e.length||"",onChange:e=>i("length",parseInt(e)||null)})),(0,a.createElement)("div",{className:"affinite-db-manager__form-group affinite-db-manager__form-group--inline"},(0,a.createElement)(n.CheckboxControl,{label:(0,l.__)("Nullable","affinite-db-manager"),checked:e.nullable,onChange:e=>i("nullable",e)})),(0,a.createElement)("div",{className:"affinite-db-manager__form-group"},(0,a.createElement)(n.TextControl,{label:(0,l.__)("Default","affinite-db-manager"),value:e.default||"",onChange:e=>i("default",e)})),(0,a.createElement)("div",{className:"affinite-db-manager__form-group affinite-db-manager__form-group--inline"},(0,a.createElement)(n.CheckboxControl,{label:(0,l.__)("Auto Increment","affinite-db-manager"),checked:e.auto_increment,onChange:e=>i("auto_increment",e)})))},U=({tableName:e,columns:i,isLocked:m,onUpdate:c,showNotification:s})=>{const[o,d]=(0,t.useState)(!1),[f,u]=(0,t.useState)(null),[g,E]=(0,t.useState)(null),[h,v]=(0,t.useState)(!1),[y,p]=(0,t.useState)({name:"",type:"VARCHAR",length:255,nullable:!0,default:"",auto_increment:!1}),C=(0,a.createElement)(a.Fragment,null,(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>d(!1),disabled:h},(0,l.__)("Cancel","affinite-db-manager")),(0,a.createElement)(n.Button,{variant:"primary",onClick:async()=>{if(y.name){v(!0);try{await(async(e,a)=>r()({path:`${x}/tables/${e}/columns`,method:"POST",data:a}))(e,y),s((0,l.__)("Column added successfully.","affinite-db-manager"),"success"),d(!1),p({name:"",type:"VARCHAR",length:255,nullable:!0,default:"",auto_increment:!1}),c()}catch(e){s(e.message||(0,l.__)("Failed to add column.","affinite-db-manager"),"error")}finally{v(!1)}}else s((0,l.__)("Column name is required.","affinite-db-manager"),"error")},isBusy:h,disabled:h},(0,l.__)("Add","affinite-db-manager"))),N=(0,a.createElement)(a.Fragment,null,(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>u(null),disabled:h},(0,l.__)("Cancel","affinite-db-manager")),(0,a.createElement)(n.Button,{variant:"primary",onClick:async()=>{if(f){v(!0);try{await(async(e,a,t)=>r()({path:`${x}/tables/${e}/columns/${a}`,method:"PUT",data:t}))(e,f.originalName,{name:f.name,type:f.type,length:f.length,nullable:f.nullable,default:f.default,auto_increment:f.auto_increment}),s((0,l.__)("Column updated successfully.","affinite-db-manager"),"success"),u(null),c()}catch(e){s(e.message||(0,l.__)("Failed to update column.","affinite-db-manager"),"error")}finally{v(!1)}}},isBusy:h,disabled:h},(0,l.__)("Save","affinite-db-manager")));return(0,a.createElement)("div",{className:"affinite-db-manager__column-editor"},!m&&(0,a.createElement)("div",{style:{marginBottom:"15px"}},(0,a.createElement)(n.Button,{variant:"primary",onClick:()=>d(!0)},(0,l.__)("+ Add Column","affinite-db-manager"))),(0,a.createElement)("table",{className:"affinite-db-manager__data-table"},(0,a.createElement)("thead",null,(0,a.createElement)("tr",null,(0,a.createElement)("th",null,(0,l.__)("Name","affinite-db-manager")),(0,a.createElement)("th",null,(0,l.__)("Type","affinite-db-manager")),(0,a.createElement)("th",null,(0,l.__)("Null","affinite-db-manager")),(0,a.createElement)("th",null,(0,l.__)("Default","affinite-db-manager")),(0,a.createElement)("th",null,(0,l.__)("Extra","affinite-db-manager")),!m&&(0,a.createElement)("th",null,(0,l.__)("Actions","affinite-db-manager")))),(0,a.createElement)("tbody",null,i.map(e=>{var t;return(0,a.createElement)("tr",{key:e.name},(0,a.createElement)("td",null,(0,a.createElement)("strong",null,e.name),"PRI"===e.key&&(0,a.createElement)("span",{title:"Primary Key"}," ðŸ”‘")),(0,a.createElement)("td",null,e.type),(0,a.createElement)("td",null,e.nullable?"YES":"NO"),(0,a.createElement)("td",null,null!==(t=e.default)&&void 0!==t?t:"-"),(0,a.createElement)("td",null,e.extra||"-"),!m&&(0,a.createElement)("td",null,(0,a.createElement)("div",{className:"affinite-db-manager__actions"},(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>(e=>{const{type:a,length:t}=(e=>{const a=e.match(/^(\w+)(?:\((\d+)(?:,\d+)?\))?/i);return a?{type:a[1].toUpperCase(),length:a[2]?parseInt(a[2]):null}:{type:e.toUpperCase(),length:null}})(e.type);u({originalName:e.name,name:e.name,type:a,length:t,nullable:e.nullable,default:e.default||"",auto_increment:e.extra.toLowerCase().includes("auto_increment")})})(e),isSmall:!0},(0,a.createElement)(k,null)),(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>E(e.name),isSmall:!0,isDestructive:!0},(0,a.createElement)(B,null)))))}))),o&&(0,a.createElement)(_,{title:(0,l.__)("Add Column","affinite-db-manager"),onClose:()=>d(!1),footer:C},(0,a.createElement)(O,{column:y,onChange:p})),f&&(0,a.createElement)(_,{title:(0,l.__)("Edit Column","affinite-db-manager"),onClose:()=>u(null),footer:N},(0,a.createElement)(O,{column:f,onChange:u})),g&&(0,a.createElement)(b,{title:(0,l.__)("Delete Column","affinite-db-manager"),message:(0,l.__)(`Are you sure you want to delete column "${g}"?`,"affinite-db-manager"),confirmLabel:(0,l.__)("Delete","affinite-db-manager"),isDangerous:!0,onConfirm:async()=>{if(g){v(!0);try{await(async(e,a)=>r()({path:`${x}/tables/${e}/columns/${a}`,method:"DELETE"}))(e,g),s((0,l.__)("Column deleted successfully.","affinite-db-manager"),"success"),E(null),c()}catch(e){s(e.message||(0,l.__)("Failed to delete column.","affinite-db-manager"),"error")}finally{v(!1)}}},onCancel:()=>E(null)}))},F=[{label:"INDEX",value:"INDEX"},{label:"UNIQUE",value:"UNIQUE"},{label:"FULLTEXT",value:"FULLTEXT"},{label:"SPATIAL",value:"SPATIAL"}],P=({tableName:e,indexes:i,columns:m,isLocked:c,onUpdate:s,showNotification:o})=>{const[d,f]=(0,t.useState)(!1),[u,g]=(0,t.useState)(null),[E,h]=(0,t.useState)(!1),[v,y]=(0,t.useState)({name:"",type:"INDEX",columns:[]}),p=(0,a.createElement)(a.Fragment,null,(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>f(!1),disabled:E},(0,l.__)("Cancel","affinite-db-manager")),(0,a.createElement)(n.Button,{variant:"primary",onClick:async()=>{if(v.name)if(0!==v.columns.length){h(!0);try{await(async(e,a)=>r()({path:`${A}/tables/${e}/indexes`,method:"POST",data:a}))(e,v),o((0,l.__)("Index added successfully.","affinite-db-manager"),"success"),f(!1),y({name:"",type:"INDEX",columns:[]}),s()}catch(e){o(e.message||(0,l.__)("Failed to add index.","affinite-db-manager"),"error")}finally{h(!1)}}else o((0,l.__)("Select at least one column.","affinite-db-manager"),"error");else o((0,l.__)("Index name is required.","affinite-db-manager"),"error")},isBusy:E,disabled:E},(0,l.__)("Add","affinite-db-manager")));return(0,a.createElement)("div",{className:"affinite-db-manager__index-manager"},!c&&(0,a.createElement)("div",{style:{marginBottom:"15px"}},(0,a.createElement)(n.Button,{variant:"primary",onClick:()=>f(!0)},(0,l.__)("+ Add Index","affinite-db-manager"))),(0,a.createElement)("table",{className:"affinite-db-manager__data-table"},(0,a.createElement)("thead",null,(0,a.createElement)("tr",null,(0,a.createElement)("th",null,(0,l.__)("Name","affinite-db-manager")),(0,a.createElement)("th",null,(0,l.__)("Type","affinite-db-manager")),(0,a.createElement)("th",null,(0,l.__)("Columns","affinite-db-manager")),!c&&(0,a.createElement)("th",null,(0,l.__)("Actions","affinite-db-manager")))),(0,a.createElement)("tbody",null,i.map(e=>(0,a.createElement)("tr",{key:e.name},(0,a.createElement)("td",null,(0,a.createElement)("strong",null,e.name)),(0,a.createElement)("td",null,e.type),(0,a.createElement)("td",null,e.columns.join(", ")),!c&&(0,a.createElement)("td",null,"PRIMARY"!==e.name&&(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>g(e.name),isSmall:!0,isDestructive:!0},(0,a.createElement)(B,null))))),0===i.length&&(0,a.createElement)("tr",null,(0,a.createElement)("td",{colSpan:c?3:4,style:{textAlign:"center"}},(0,l.__)("No indexes found.","affinite-db-manager"))))),d&&(0,a.createElement)(_,{title:(0,l.__)("Add Index","affinite-db-manager"),onClose:()=>f(!1),footer:p},(0,a.createElement)("div",{className:"affinite-db-manager__form-group"},(0,a.createElement)(n.TextControl,{label:(0,l.__)("Index Name","affinite-db-manager"),value:v.name,onChange:e=>y({...v,name:e})})),(0,a.createElement)("div",{className:"affinite-db-manager__form-group"},(0,a.createElement)(n.SelectControl,{label:(0,l.__)("Type","affinite-db-manager"),value:v.type,options:F,onChange:e=>y({...v,type:e})})),(0,a.createElement)("div",{className:"affinite-db-manager__form-group"},(0,a.createElement)("label",null,(0,l.__)("Columns","affinite-db-manager")),(0,a.createElement)("div",{style:{marginTop:"10px"}},m.map(e=>(0,a.createElement)("div",{key:e.name,style:{marginBottom:"5px"}},(0,a.createElement)(n.CheckboxControl,{label:e.name,checked:v.columns.includes(e.name),onChange:()=>(e=>{const a=v.columns;a.includes(e)?y({...v,columns:a.filter(a=>a!==e)}):y({...v,columns:[...a,e]})})(e.name)})))))),u&&(0,a.createElement)(b,{title:(0,l.__)("Delete Index","affinite-db-manager"),message:(0,l.__)(`Are you sure you want to delete index "${u}"?`,"affinite-db-manager"),confirmLabel:(0,l.__)("Delete","affinite-db-manager"),isDangerous:!0,onConfirm:async()=>{if(u){h(!0);try{await(async(e,a)=>r()({path:`${A}/tables/${e}/indexes/${a}`,method:"DELETE"}))(e,u),o((0,l.__)("Index deleted successfully.","affinite-db-manager"),"success"),g(null),s()}catch(e){o(e.message||(0,l.__)("Failed to delete index.","affinite-db-manager"),"error")}finally{h(!1)}}},onCancel:()=>g(null)}))},z=[{label:"RESTRICT",value:"RESTRICT"},{label:"CASCADE",value:"CASCADE"},{label:"SET NULL",value:"SET NULL"},{label:"NO ACTION",value:"NO ACTION"}],H=[...z],V=({tableName:e,relations:i,columns:m,isLocked:c,onUpdate:s,showNotification:o})=>{const[d,u]=(0,t.useState)(!1),[g,E]=(0,t.useState)(null),[h,v]=(0,t.useState)(!1),[y,p]=(0,t.useState)([]),[C,N]=(0,t.useState)([]),[w,S]=(0,t.useState)({column:"",referenced_table:"",referenced_column:"",on_delete:"RESTRICT",on_update:"RESTRICT"});(0,t.useEffect)(()=>{(async()=>{try{const e=await f();p(e)}catch(e){}})()},[]),(0,t.useEffect)(()=>{(async()=>{if(w.referenced_table)try{const e=await I(w.referenced_table);N(e)}catch(e){N([])}else N([])})()},[w.referenced_table]);const k=[{label:(0,l.__)("Select column...","affinite-db-manager"),value:""},...m.map(e=>({label:e.name,value:e.name}))],T=[{label:(0,l.__)("Select table...","affinite-db-manager"),value:""},...y.map(e=>({label:e.name,value:e.name}))],L=[{label:(0,l.__)("Select column...","affinite-db-manager"),value:""},...C.map(e=>({label:e.name,value:e.name}))],x=(0,a.createElement)(a.Fragment,null,(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>u(!1),disabled:h},(0,l.__)("Cancel","affinite-db-manager")),(0,a.createElement)(n.Button,{variant:"primary",onClick:async()=>{if(w.column)if(w.referenced_table)if(w.referenced_column){v(!0);try{await(async(e,a)=>r()({path:`${$}/tables/${e}/relations`,method:"POST",data:a}))(e,w),o((0,l.__)("Relation added successfully.","affinite-db-manager"),"success"),u(!1),S({column:"",referenced_table:"",referenced_column:"",on_delete:"RESTRICT",on_update:"RESTRICT"}),s()}catch(e){o(e.message||(0,l.__)("Failed to add relation.","affinite-db-manager"),"error")}finally{v(!1)}}else o((0,l.__)("Referenced column is required.","affinite-db-manager"),"error");else o((0,l.__)("Referenced table is required.","affinite-db-manager"),"error");else o((0,l.__)("Column is required.","affinite-db-manager"),"error")},isBusy:h,disabled:h},(0,l.__)("Add","affinite-db-manager")));return(0,a.createElement)("div",{className:"affinite-db-manager__relation-editor"},!c&&(0,a.createElement)("div",{style:{marginBottom:"15px"}},(0,a.createElement)(n.Button,{variant:"primary",onClick:()=>u(!0)},(0,l.__)("+ Add Relation","affinite-db-manager"))),(0,a.createElement)("table",{className:"affinite-db-manager__data-table"},(0,a.createElement)("thead",null,(0,a.createElement)("tr",null,(0,a.createElement)("th",null,(0,l.__)("Column","affinite-db-manager")),(0,a.createElement)("th",null,(0,l.__)("References","affinite-db-manager")),(0,a.createElement)("th",null,(0,l.__)("ON DELETE","affinite-db-manager")),(0,a.createElement)("th",null,(0,l.__)("ON UPDATE","affinite-db-manager")),!c&&(0,a.createElement)("th",null,(0,l.__)("Actions","affinite-db-manager")))),(0,a.createElement)("tbody",null,i.map(e=>(0,a.createElement)("tr",{key:e.name},(0,a.createElement)("td",null,(0,a.createElement)("strong",null,e.column)),(0,a.createElement)("td",null,e.referenced_table,".",e.referenced_column),(0,a.createElement)("td",null,e.on_delete),(0,a.createElement)("td",null,e.on_update),!c&&(0,a.createElement)("td",null,(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>E(e.name),isSmall:!0,isDestructive:!0},(0,a.createElement)(B,null))))),0===i.length&&(0,a.createElement)("tr",null,(0,a.createElement)("td",{colSpan:c?4:5,style:{textAlign:"center"}},(0,l.__)("No relations found.","affinite-db-manager"))))),d&&(0,a.createElement)(_,{title:(0,l.__)("Add Relation (Foreign Key)","affinite-db-manager"),onClose:()=>u(!1),footer:x},(0,a.createElement)("div",{className:"affinite-db-manager__form-group"},(0,a.createElement)(n.SelectControl,{label:(0,l.__)("Column","affinite-db-manager"),value:w.column,options:k,onChange:e=>S({...w,column:e})})),(0,a.createElement)("div",{className:"affinite-db-manager__form-group"},(0,a.createElement)(n.SelectControl,{label:(0,l.__)("Referenced Table","affinite-db-manager"),value:w.referenced_table,options:T,onChange:e=>S({...w,referenced_table:e,referenced_column:""})})),(0,a.createElement)("div",{className:"affinite-db-manager__form-group"},(0,a.createElement)(n.SelectControl,{label:(0,l.__)("Referenced Column","affinite-db-manager"),value:w.referenced_column,options:L,onChange:e=>S({...w,referenced_column:e}),disabled:!w.referenced_table})),(0,a.createElement)("div",{className:"affinite-db-manager__form-group"},(0,a.createElement)(n.SelectControl,{label:(0,l.__)("ON DELETE","affinite-db-manager"),value:w.on_delete,options:z,onChange:e=>S({...w,on_delete:e})})),(0,a.createElement)("div",{className:"affinite-db-manager__form-group"},(0,a.createElement)(n.SelectControl,{label:(0,l.__)("ON UPDATE","affinite-db-manager"),value:w.on_update,options:H,onChange:e=>S({...w,on_update:e})}))),g&&(0,a.createElement)(b,{title:(0,l.__)("Delete Relation","affinite-db-manager"),message:(0,l.__)("Are you sure you want to delete this foreign key?","affinite-db-manager"),confirmLabel:(0,l.__)("Delete","affinite-db-manager"),isDangerous:!0,onConfirm:async()=>{if(g){v(!0);try{await(async(e,a)=>r()({path:`${$}/tables/${e}/relations/${a}`,method:"DELETE"}))(e,g),o((0,l.__)("Relation deleted successfully.","affinite-db-manager"),"success"),E(null),s()}catch(e){o(e.message||(0,l.__)("Failed to delete relation.","affinite-db-manager"),"error")}finally{v(!1)}}},onCancel:()=>E(null)}))},X=({tableName:e,data:i,showNotification:r})=>{const[m,c]=(0,t.useState)(i),[s,o]=(0,t.useState)(!1),[d,f]=(0,t.useState)(0);if(!m)return(0,a.createElement)("div",{className:"affinite-db-manager__no-data"},(0,l.__)("No data available.","affinite-db-manager"));const{columns:u,rows:_,total:b}=m,g=Math.ceil(b/100),E=async a=>{o(!0);try{const t=await R(e,100,100*a);c(t),f(a)}catch(e){r(e.message||(0,l.__)("Failed to load data.","affinite-db-manager"),"error")}finally{o(!1)}};return(0,a.createElement)("div",{className:"affinite-db-manager__data-preview"},(0,a.createElement)("p",null,(0,l.__)("Showing","affinite-db-manager")," ",_.length," ",(0,l.__)("of","affinite-db-manager")," ",b.toLocaleString()," ",(0,l.__)("rows","affinite-db-manager")),(0,a.createElement)("div",{style:{overflowX:"auto"}},(0,a.createElement)("table",{className:"affinite-db-manager__data-table"},(0,a.createElement)("thead",null,(0,a.createElement)("tr",null,u.map(e=>(0,a.createElement)("th",{key:e},e)))),(0,a.createElement)("tbody",null,_.map((e,t)=>(0,a.createElement)("tr",{key:t},u.map(t=>(0,a.createElement)("td",{key:t},(e=>{if(null===e)return(0,a.createElement)("em",null,"NULL");if("boolean"==typeof e)return e?"true":"false";const t=String(e);return t.length>100?t.substring(0,100)+"...":t})(e[t]))))),0===_.length&&(0,a.createElement)("tr",null,(0,a.createElement)("td",{colSpan:u.length,style:{textAlign:"center"}},(0,l.__)("No data found.","affinite-db-manager")))))),g>1&&(0,a.createElement)("div",{className:"affinite-db-manager__pagination"},(0,a.createElement)("span",null,(0,l.__)("Page","affinite-db-manager")," ",d+1," ",(0,l.__)("of","affinite-db-manager")," ",g),(0,a.createElement)("div",null,(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>E(d-1),disabled:0===d||s,isSmall:!0},(0,l.__)("Previous","affinite-db-manager")),(0,a.createElement)(n.Button,{variant:"secondary",onClick:()=>E(d+1),disabled:d>=g-1||s,isSmall:!0,style:{marginLeft:"10px"}},(0,l.__)("Next","affinite-db-manager")))))},Y=(0,t.memo)(({className:e="",size:t=20})=>{const n=`affinite-db-manager__icon-svg ${e}`.trim();return(0,a.createElement)("svg",{className:n,width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},(0,a.createElement)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z",fill:"currentColor"}))});Y.displayName="ArrowBackIcon";const q=Y,G="columns",W="indexes",K="relations",j="data",J=(0,t.memo)(({tableName:e,onBack:i,showNotification:m})=>{const{table:c,loading:s,error:o,refetch:f}=(e=>{const[a,n]=(0,t.useState)(null),[l,i]=(0,t.useState)(!0),[m,c]=(0,t.useState)(null),s=(0,t.useCallback)(async()=>{if(!e)return n(null),void i(!1);try{i(!0),c(null);const a=await(async e=>r()({path:`${d}/tables/${e}`}))(e);n(a)}catch(e){c(e.message||"Failed to load table")}finally{i(!1)}},[e]),o=(0,t.useCallback)(()=>{s()},[s]);return(0,t.useEffect)(()=>{s()},[s]),{table:a,loading:l,error:m,refetch:o}})(e),[u,_]=(0,t.useState)(G),[b,g]=(0,t.useState)([]),[h,v]=(0,t.useState)([]),[y,p]=(0,t.useState)([]),[C,N]=(0,t.useState)(null),[w,S]=(0,t.useState)(!1),[k,T]=(0,t.useState)(!0);(0,t.useEffect)(()=>{g([]),v([]),p([]),N(null),T(!0),_(G)},[e]),(0,t.useEffect)(()=>{e&&c&&k&&(async()=>{S(!0);try{const[a,t,n]=await Promise.all([I(e),D(e),M(e)]);g(a),v(t),p(n),T(!1)}catch(e){m(e.message||(0,l.__)("Failed to load data.","affinite-db-manager"),"error"),T(!1)}finally{S(!1)}})()},[e,c,k,m]),(0,t.useEffect)(()=>{u===j&&null===C&&e&&(async()=>{S(!0);try{const a=await R(e);N(a)}catch(e){m(e.message||(0,l.__)("Failed to load data.","affinite-db-manager"),"error")}finally{S(!1)}})()},[u,e,C,m]);const B=(0,t.useCallback)(async()=>{if(e){S(!0);try{switch(u){case G:const a=await I(e);g(a);break;case W:const t=await D(e);v(t);break;case K:const n=await M(e);p(n);break;case j:const l=await R(e);N(l)}}catch(e){m(e.message||(0,l.__)("Failed to refresh data.","affinite-db-manager"),"error")}finally{S(!1)}}},[e,u,m]);return s?(0,a.createElement)("div",{className:"affinite-db-manager__loading"},(0,a.createElement)(n.Spinner,null),(0,a.createElement)("span",null,(0,l.__)("Loading table...","affinite-db-manager"))):o||!c?(0,a.createElement)("div",{className:"affinite-db-manager__error"},(0,a.createElement)("p",null,o||(0,l.__)("Table not found.","affinite-db-manager")),(0,a.createElement)(n.Button,{variant:"primary",onClick:i},(0,l.__)("Back","affinite-db-manager"))):(0,a.createElement)("div",{className:"affinite-db-manager__table-detail"},(0,a.createElement)("div",{className:"affinite-db-manager__back"},(0,a.createElement)(n.Button,{variant:"link",onClick:i},(0,a.createElement)(q,null)," ",(0,l.__)("Back to Tables","affinite-db-manager"))),(0,a.createElement)("div",{className:"affinite-db-manager__card"},(0,a.createElement)("div",{className:"affinite-db-manager__card-header"},(0,a.createElement)("h2",null,(0,a.createElement)(E,{locked:c.is_locked}),c.name),(0,a.createElement)("span",null,c.columns," ",(0,l.__)("columns","affinite-db-manager")," â€¢ ",c.rows.toLocaleString()," ",(0,l.__)("rows","affinite-db-manager"))),(0,a.createElement)("div",{className:"affinite-db-manager__tabs"},(0,a.createElement)("button",{className:"affinite-db-manager__tab "+(u===G?"affinite-db-manager__tab--active":""),onClick:()=>_(G)},(0,l.__)("Columns","affinite-db-manager")),(0,a.createElement)("button",{className:"affinite-db-manager__tab "+(u===W?"affinite-db-manager__tab--active":""),onClick:()=>_(W)},(0,l.__)("Indexes","affinite-db-manager")),(0,a.createElement)("button",{className:"affinite-db-manager__tab "+(u===K?"affinite-db-manager__tab--active":""),onClick:()=>_(K)},(0,l.__)("Relations","affinite-db-manager")),(0,a.createElement)("button",{className:"affinite-db-manager__tab "+(u===j?"affinite-db-manager__tab--active":""),onClick:()=>_(j)},(0,l.__)("Data","affinite-db-manager"))),(0,a.createElement)("div",{className:"affinite-db-manager__card-body"},w&&(k||u===j)?(0,a.createElement)("div",{className:"affinite-db-manager__loading"},(0,a.createElement)(n.Spinner,null),(0,a.createElement)("span",null,(0,l.__)("Loading...","affinite-db-manager"))):(0,a.createElement)(a.Fragment,null,u===G&&(0,a.createElement)(U,{tableName:e,columns:b,isLocked:c.is_locked,onUpdate:B,showNotification:m}),u===W&&(0,a.createElement)(P,{tableName:e,indexes:h,columns:b,isLocked:c.is_locked,onUpdate:B,showNotification:m}),u===K&&(0,a.createElement)(V,{tableName:e,relations:y,columns:b,isLocked:c.is_locked,onUpdate:B,showNotification:m}),u===j&&(0,a.createElement)(X,{tableName:e,data:C,showNotification:m})))))}),Q=(0,t.memo)(({className:e="",size:t=24})=>{const n=`affinite-db-manager__icon-svg ${e}`.trim();return(0,a.createElement)("svg",{className:n,width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},(0,a.createElement)("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z",fill:"currentColor"}))});Q.displayName="WarningIcon";const Z=Q,ee=(0,t.memo)(({settings:e,showNotification:n})=>{const{isActive:i,hasAccess:r}=(e=>({isActive:(0,t.useMemo)(()=>{var a;return null!==(a=e?.active)&&void 0!==a&&a},[e]),hasAccess:(0,t.useMemo)(()=>!!e&&!(!e.allowed_emails||0===e.allowed_emails.length),[e]),canManage:(0,t.useMemo)(()=>null!==e,[e])}))(e),[m,c]=(0,t.useState)(null),s=(0,t.useCallback)(()=>{c(null)},[]),o=(0,t.useCallback)(e=>{c(e)},[]);if(!i||!r){const t=!e?.allowed_emails||0===e.allowed_emails.length;return(0,a.createElement)("div",{className:"affinite-db-manager__no-access"},(0,a.createElement)("div",{className:"affinite-db-manager__no-access-icon"},(0,a.createElement)(Z,{size:48})),t?(0,a.createElement)(a.Fragment,null,(0,a.createElement)("p",null,(0,l.__)("No users are allowed to view tables yet.","affinite-db-manager")),(0,a.createElement)("p",null,(0,l.__)("Please add at least one email address in the Settings tab to enable table access.","affinite-db-manager"))):(0,a.createElement)(a.Fragment,null,(0,a.createElement)("p",null,(0,l.__)("DB Manager is not active or you do not have permission.","affinite-db-manager")),(0,a.createElement)("p",null,(0,l.__)("Contact administrator.","affinite-db-manager"))))}return m?(0,a.createElement)(J,{tableName:m,onBack:s,showNotification:n}):(0,a.createElement)(L,{onSelectTable:o,showNotification:n})}),ae=({message:e,type:l="info",onDismiss:i,autoDismiss:r=5e3})=>((0,t.useEffect)(()=>{if(r>0&&i){const e=setTimeout(i,r);return()=>clearTimeout(e)}},[r,i]),(0,a.createElement)("div",{className:`affinite-db-manager__notification affinite-db-manager__notification--${l}`},(0,a.createElement)("span",null,e),i&&(0,a.createElement)(n.Button,{variant:"link",onClick:i,"aria-label":"Dismiss notification"},"Ã—"))),te=({page:e})=>{const{settings:i,loading:s,error:o,refetch:d}=(()=>{const[e,a]=(0,t.useState)(null),[n,l]=(0,t.useState)(!0),[i,s]=(0,t.useState)(null),o=(0,t.useRef)(!0),d=(0,t.useCallback)(async()=>{try{l(!0),s(null);const e=await c();a(e)}catch(e){s(e.message||"Failed to load settings")}finally{l(!1)}},[]),f=(0,t.useCallback)(async t=>{if(!e)throw new Error("Settings not loaded");const n={...e,...t};a(n);try{const e=await(async e=>r()({path:`${m}/settings`,method:"POST",data:e}))(t);return e?.settings&&a(e.settings),e?.settings||n}catch(t){throw a(e),t}},[e]),u=(0,t.useCallback)(async()=>{try{const e=await c();a(e)}catch(e){console.error("Failed to refresh settings:",e)}},[]);return(0,t.useEffect)(()=>{o.current&&(o.current=!1,d())},[d]),{settings:e,loading:n,error:i,refetch:u,updateSettingsOptimistic:f}})(),[f,u]=(0,t.useState)(null),_=(0,t.useCallback)((e,a="success")=>{u({message:e,type:a})},[]),b=(0,t.useCallback)(()=>{u(null)},[]);return s?(0,a.createElement)("div",{className:"affinite-db-manager"},(0,a.createElement)("div",{className:"affinite-db-manager__loading"},(0,a.createElement)(n.Spinner,null),(0,a.createElement)("span",null,(0,l.__)("Loading...","affinite-db-manager")))):o?(0,a.createElement)("div",{className:"affinite-db-manager"},(0,a.createElement)("div",{className:"affinite-db-manager__error"},(0,a.createElement)("p",null,(0,l.__)("Error loading data:","affinite-db-manager")," ",o))):(0,a.createElement)("div",{className:"affinite-db-manager"},f&&(0,a.createElement)(ae,{message:f.message,type:f.type,onDismiss:b}),"settings"===e&&(0,a.createElement)(y,{settings:i,onUpdate:d,showNotification:_}),"manager"===e&&(0,a.createElement)(ee,{settings:i,showNotification:_}))};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("affinite-db-manager-root"),n=document.getElementById("affinite-db-manager-settings-root");e&&(0,t.createRoot)(e).render((0,a.createElement)(te,{page:"manager"})),n&&(0,t.createRoot)(n).render((0,a.createElement)(te,{page:"settings"}))})})();